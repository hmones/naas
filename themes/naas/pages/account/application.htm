title = "Application"
url = "/account/application"
layout = "default"
is_hidden = 0

[Countries]

[session]
security = "user"
redirect = "account/login"
==
use Hmones\Membership\Models\Submission;
use Hmones\Membership\Models\Theme;
use Hmones\Membership\Models\Round;
use Hmones\Membership\Models\Response;
use Hmones\Membership\Models\Question;
use Hmones\Membership\Models\Option;

public function onStart(){
$this['sections'] = Theme::with([
'questions' => function ($query) {
$query->orderBy('order', 'asc');
}
])->get();
$this['repeat_groups'] =
Question::select('group','repeat_text')->where('published','1')->whereNotNull('group')->distinct('group')->get()->toJson();
}
==
<div class="ui stackable grid">
    <div class="five wide column">
        <div class="ui fluid vertical right attached steps">
            {% for section in sections %}
            <a class="{{loop.index == 1? 'active':''}} step" id="section_btn_{{section.id}}"
                style="border-bottom:4px solid rgba(253,210,186,.15);" onclick="activateSection({{section.id}});">
                <i class="{{section.icon}} red icon" style="font-size:17px;"></i>
                <div class="content">
                    <div class="title">{{str_limit(section.theme,24)}}</div>
                    <div class="description">{{str_limit(section.description,30)}}</div>
                </div>
            </a>
            {% endfor %}
        </div>
    </div>
    <div class="eleven wide column">
        <form action="" method="POST" enctype="multipart/form-data" class="ui form"></form>
        {% for section in sections %}
        <div class="ui attached {{loop.index == 1? 'active':''}} segment" id="section_content_{{section.id}}"
            style="{{loop.index == 1? '':'display:none;'}} border:none;">
            <div class="ui header">{{section.theme}}</div>
            <div class="ui divider"></div>
            <div class="ui form">
                {% for question in section.questions %}
                {% partial 'account/renderQuestions' question=question countries=countries %}
                {% endfor %}
            </div>
        </div>
        {% endfor %}
        </form>
    </div>
</div>

{% put scripts %}
<script>
    $('.ui.dropdown').dropdown();
    function activateSection(section) {
        var section_btn = '#section_btn_' + section;
        var section_content = '#section_content_' + section;
        $('a.active.step').removeClass('active');
        $(section_btn).addClass('active');
        $('div.ui.attached.active.segment').removeClass('active').hide();
        $(section_content).addClass('active').fadeIn();
    }
    $('input[type=radio][dataoption]').change(function () {
        var selector = 'div[data-condition=' + this.attributes.dataoption.value + ']';
        $(selector).parent().show();
        $(selector).fadeIn();
        $(this).addClass("active");
        $('input[type=radio]:not(:checked).active').map(function (index, option) {
            $(option).removeClass("active");
            var selector = 'div[data-condition=' + option.attributes.dataoption.value + ']';
            $(selector).fadeOut();
        });
    });
    $(function () {
        var repeat_groups = $.parseJSON('{{ repeat_groups | raw }}');
        repeat_groups.forEach(group => {
            $('div[group=' + group.group + ']').wrapAll('<div id="q_group_' + group.group + '" class="ui repeating pink segment"/>');
            $('#q_group_' + group.group)
                .append(
                    '<div class="repeat group addons"><div id="repeat_group_'
                    + group.group +
                    '_container"></div><a href="javascript:void(0)" onclick="handleRepeat('
                    + group.group +
                    ')" class="ui basic red right floated button repeater"><i class="plus icon"></i>'
                    + group.repeat_text +
                    '</a><div><br></br>'
                );
            if ($('#q_group_' + group.group).children().css("display") == "none") {
                $('#q_group_' + group.group).hide();
            }
        });

    });
    function handleRepeat(group) {
        var data_prev = $('#q_group_' + group).html();
        var data_current = '<div><a href="javascript:void(0)" class="ui right floated basic segment" onclick="$(this).parent().empty();"><i class="close red icon"></i></a>'
            + data_prev +
            '</div>';
        $('#repeat_group_' + group + '_container')
            .append(data_current);
        $('#repeat_group_' + group + '_container > div > div.repeat.group.addons').remove();
        $('#repeat_group_' + group + '_container > div > div > div.ui.header.question').remove();
        $('.ui.dropdown').dropdown();
    }
</script>
{% endput %}